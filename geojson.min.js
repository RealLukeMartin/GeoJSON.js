// geojson.js - v0.4.1
// (c) 2019 Casey Cesari, MIT License

!function(y){function l(){var r=1<=arguments.length?[].slice.call(arguments,0):[],e=r.shift(),t=r.shift();Error.apply(this,r),this.message=this.message||"Invalid Geometry: item: "+JSON.stringify(e)+", params: "+JSON.stringify(t)}y.version="0.4.1",y.defaults={doThrows:{invalidGeometry:!1}},l.prototype=Error,y.errors={InvalidGeometryError:l},y.isGeometryValid=function(r){return!(!r||!Object.keys(r).length)&&(!!r.type&&!!r.coordinates&&Array.isArray(r.coordinates)&&!!r.coordinates.length)},y.parse=function(r,e,t){var o,n,i=function(r,e){var t=r||{};for(var o in e)e.hasOwnProperty(o)&&!t[o]&&(t[o]=e[o]);return t}(e,this.defaults);if(s.length=0,function(r){for(var e in r.geom={},r)r.hasOwnProperty(e)&&-1!==a.indexOf(e)&&(r.geom[e]=r[e],delete r[e]);!function(r){for(var e in r)r.hasOwnProperty(e)&&("string"==typeof r[e]?s.push(r[e]):"object"==typeof r[e]&&(s.push(r[e][0]),s.push(r[e][1])));if(0===s.length)throw new Error("No geometry attributes specified")}(r.geom)}(i),n=function(t){var e;t.exclude||t.include?t.include?e=function(e){t.include.forEach(function(r){e[r]=this[r]},this)}:t.exclude&&(e=function(r){for(var e in this)this.hasOwnProperty(e)&&-1===s.indexOf(e)&&-1===t.exclude.indexOf(e)&&(r[e]=this[e])}):e=function(r){for(var e in this)this.hasOwnProperty(e)&&-1===s.indexOf(e)&&(r[e]=this[e])};return function(){var r={};return e.call(this,r),t.extra&&function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])}(r,t.extra),r}}(i),Array.isArray(r)?(o={type:"FeatureCollection",features:[]},r.forEach(function(r){o.features.push(p({item:r,params:i,propFunc:n}))}),u(o,i)):u(o=p({item:r,params:i,propFunc:n}),i),!t||"function"!=typeof t)return o;t(o)};var a=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeoJSON"],s=[];function u(r,e){if(e.crs&&function(r){{if("name"===r.type){if(r.properties&&r.properties.name)return!0;throw new Error('Invalid CRS. Properties must contain "name" key')}if("link"!==r.type)throw new Error('Invald CRS. Type attribute must be "name" or "link"');if(r.properties&&r.properties.href&&r.properties.type)return!0;throw new Error('Invalid CRS. Properties must contain "href" and "type" key')}}(e.crs)&&(e.isPostgres?r.geometry.crs=e.crs:r.crs=e.crs),e.bbox&&(r.bbox=e.bbox),e.extraGlobal)for(var t in r.properties={},e.extraGlobal)r.properties[t]=e.extraGlobal[t]}function p(r){var e=r.item,t=r.params,o=r.propFunc,n={type:"Feature"};return n.geometry=function o(n,r){var e={};for(var t in r.geom){var i=r.geom[t];if("string"==typeof i&&n.hasOwnProperty(i))"GeoJSON"===t?e=n[i]:(e.type=t,e.coordinates=n[i]);else if("object"!=typeof i||Array.isArray(i))if(Array.isArray(i)&&n.hasOwnProperty(i[0])&&n.hasOwnProperty(i[1])&&n.hasOwnProperty(i[2]))e.type=t,e.coordinates=[Number(n[i[1]]),Number(n[i[0]]),Number(n[i[2]])];else if(Array.isArray(i)&&n.hasOwnProperty(i[0])&&n.hasOwnProperty(i[1]))e.type=t,e.coordinates=[Number(n[i[1]]),Number(n[i[0]])];else if(Array.isArray(i)&&h(i[0])&&h(i[1])&&h(i[2])){for(var a=[],s=0;s<i.length;s++){for(var u=i[s].split("."),p=n,f=0;f<u.length;f++){if(null==p||!p.hasOwnProperty(u[f]))return!1;p=p[u[f]]}a[s]=p}e.type=t,e.coordinates=[Number(a[1]),Number(a[0]),Number(a[2])]}else if(Array.isArray(i)&&h(i[0])&&h(i[1])){for(var a=[],s=0;s<i.length;s++){for(var u=i[s].split("."),p=n,f=0;f<u.length;f++){if(null==p||!p.hasOwnProperty(u[f]))return!1;p=p[u[f]]}a[s]=p}e.type=t,e.coordinates=[Number(a[1]),Number(a[0])]}else Array.isArray(i)&&"Object"===i[0].constructor.name&&"coordinates"===Object.keys(i[0])[0]&&(e.type=t,e.coordinates=[Number(n.coordinates[i[0].coordinates.indexOf("lng")]),Number(n.coordinates[i[0].coordinates.indexOf("lat")])]);else{var c=Object.keys(i).map(function(r){var e=i[r],t=n[r];return o(t,{geom:{Point:e}})});e.type=t,e.coordinates=[].concat(c.map(function(r){return r.coordinates}))}}if(r.doThrows&&r.doThrows.invalidGeometry&&!y.isGeometryValid(e))throw new l(n,r);return e}(e,t),n.properties=o.call(e),n}function h(r){return/^.+\..+$/.test(r)}}("object"==typeof module?module.exports:window.GeoJSON={});